{% extends "layout.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/partners.css') }}">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<main class="modern-wrapper">
    <section class="partners-modern-section pt-5 pb-3">
        <div class="container">
            <h6 class="trusted-heading text-center text-muted mb-4 small text-uppercase ls-1">–ù–∞–º –¥–æ–≤–µ—Ä—è—é—Ç –¥–∞–Ω–Ω—ã–µ</h6>
            <div class="partners-grid opacity-75 hover-opacity-100 transition-all">
                <div class="partner-card">
                    <div class="partner-logo remotive-new">Remotive</div>
                </div>
                <div class="partner-card">
                    <div class="partner-logo adzuna">Adzuna</div>
                </div>
                <div class="partner-card">
                    <div class="partner-logo jobicy">jobicy</div>
                </div>
                <div class="partner-card">
                    <div class="partner-logo careerjet">career<span>jet</span></div>
                </div>
            </div>
        </div>
    </section>

    <section class="cibc-promo-modern py-4">
        <div class="container">
            <div class="p-4 p-lg-5 border-0 rounded-5 bg-white shadow-soft position-relative overflow-hidden">
                <div class="position-absolute top-0 end-0 opacity-10" style="width: 300px; height: 100%; background: linear-gradient(135deg, #FF4757 0%, #E31837 100%); clip-path: polygon(60% 0, 100% 0, 100% 100%, 40% 100%);"></div>
                
                <div class="row align-items-center position-relative" style="z-index: 2;">
                    <div class="col-lg-8">
                        <div class="badge bg-danger-subtle text-danger mb-3 px-3 py-2 rounded-pill fw-bold">STUDENT OFFER</div>
                        <h3 class="fw-bold mb-3 display-6">Get $25 Bonus with CIBC Smart</h3>
                        <p class="text-muted mb-4 fs-5" style="max-width: 600px;">
                            Open a <strong>CIBC International Student GIC</strong> to speed up your study permit via SDS.
                        </p>
                        
                        <div class="d-flex flex-wrap align-items-center gap-3">
                            <a href="https://www.cibc.com/en/special-offers/isbo-refer-a-friend.html?utrc=E2084:1&utm_medium=Email&utm_campaign=ISBO-x-RAF-&" 
                               target="_blank" 
                               class="btn btn-dark rounded-pill px-4 py-2 fw-bold shadow-sm">
                                Get Started
                            </a>
                            <div class="d-flex align-items-center bg-light border border-light rounded-pill p-1 ps-3 shadow-inset">
                                <span class="small text-muted me-2">Code:</span>
                                <code class="fw-bold text-dark me-2">tzvanguardia@gmail.com</code>
                                <button class="btn btn-sm btn-white rounded-circle shadow-sm" onclick="copyEmail(event)" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 d-none d-lg-block text-end opacity-25">
                         <div class="cibc-logo-text" style="font-size: 80px; font-weight: 900; color: #8B0000; font-family: sans-serif;">CIBC</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
    function copyEmail(event) {
        navigator.clipboard.writeText('tzvanguardia@gmail.com');
        const btn = event.currentTarget;
        const originalIcon = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check2 text-success"></i>';
        setTimeout(() => { btn.innerHTML = originalIcon; }, 2000);
    }
    </script>

    <section class="hero-section text-center py-5">
        <div class="container py-3">
            <h1 class="display-4 fw-bolder mb-4 text-dark" style="letter-spacing: -1px;">
                –í–∞—à–∞ –Ω–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ ‚Äî <br class="d-md-none">–≤ –ª—é–±–æ–π —Ç–æ—á–∫–µ <span class="text-primary position-relative d-inline-block">–º–∏—Ä–∞
                <svg class="position-absolute w-100" style="bottom: -5px; left: 0; height: 8px; opacity: 0.3;" viewBox="0 0 100 10" preserveAspectRatio="none"><path d="M0 5 Q 50 10 100 5" stroke="#0d6efd" stroke-width="3" fill="none"/></svg>
                </span>
            </h1>
            <p class="lead text-muted mb-5 mx-auto" style="max-width: 700px; line-height: 1.6;">
                –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è —É–∫—Ä–∞–∏–Ω—Ü–µ–≤. –ú—ã —É–±—Ä–∞–ª–∏ –≤—Å—ë –ª–∏—à–Ω–µ–µ, —á—Ç–æ–±—ã –≤—ã –Ω–∞—à–ª–∏ –≤–∞–∫–∞–Ω—Å–∏–∏, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º–µ—á—Ç–∞–µ—Ç–µ.
            </p>
            <a href="#search-form-section" class="btn btn-primary btn-lg rounded-pill px-5 py-3 shadow-lg btn-glow">
                <i class="bi bi-search me-2"></i>–ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫
            </a>
        </div>
    </section>

    <section id="search-form-section" class="pb-5 bg-light-subtle">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-9 col-xl-8">
                    <form id="job-search-form" novalidate class="d-flex flex-col gap-4">
                        
                        <div class="form-step-card bg-white p-4 p-md-5 rounded-5 shadow-soft mb-4 position-relative overflow-hidden">
                            <div class="step-indicator">1</div>
                            <div class="text-center mb-5">
                                <h3 class="fw-bold mb-2">–í–∞—à —Å—Ç–∞—Ç—É—Å</h3>
                                <p class="text-muted">–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</p>
                            </div>
                            
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="selection-card h-100 cursor-pointer">
                                        <input class="form-check-input d-none" type="radio" name="is_refugee" value="true" id="refugee_yes" required>
                                        <div class="card-content p-4 border rounded-4 h-100 transition-all text-center">
                                            <div class="icon-wrapper mb-3 text-primary bg-primary-subtle rounded-circle mx-auto d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                                <i class="bi bi-passport fs-3"></i>
                                            </div>
                                            <strong class="d-block fs-5 mb-2">–£–∫—Ä–∞–∏–Ω—Å–∫–∏–π –±–µ–∂–µ–Ω–µ—Ü</strong>
                                            <span class="text-muted small">–ü–∞—Ä–∞–≥—Ä–∞—Ñ 24, –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞</span>
                                            <div class="check-mark"><i class="bi bi-check-circle-fill"></i></div>
                                        </div>
                                    </label>
                                </div>
                                <div class="col-md-6">
                                    <label class="selection-card h-100 cursor-pointer">
                                        <input class="form-check-input d-none" type="radio" name="is_refugee" value="false" id="refugee_no" required>
                                        <div class="card-content p-4 border rounded-4 h-100 transition-all text-center">
                                            <div class="icon-wrapper mb-3 text-secondary bg-secondary-subtle rounded-circle mx-auto d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                                <i class="bi bi-briefcase fs-3"></i>
                                            </div>
                                            <strong class="d-block fs-5 mb-2">–û–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫</strong>
                                            <span class="text-muted small">–†–∞–±–æ—á–∞—è –≤–∏–∑–∞, –í–ù–ñ, –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ</span>
                                            <div class="check-mark"><i class="bi bi-check-circle-fill"></i></div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-step-card bg-white p-4 p-md-5 rounded-5 shadow-soft mb-4 position-relative">
                            <div class="step-indicator">2</div>
                            <div class="text-center mb-4">
                                <h3 class="fw-bold mb-2">–ö–µ–º –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å?</h3>
                            </div>

                            <div class="mb-5 text-center">
                                <p class="text-muted small text-uppercase fw-bold ls-1 mb-3">–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã</p>
                                <div id="quick-select-buttons" class="d-flex flex-wrap justify-content-center gap-2">
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('transport', this)">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('restaurant', this)">üçΩÔ∏è –û–±—â–µ–ø–∏—Ç</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('construction', this)">üèóÔ∏è –°—Ç—Ä–æ–π–∫–∞</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('care', this)">üë• –£—Ö–æ–¥</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('it', this)">üíª IT</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('office', this)">üëî –û—Ñ–∏—Å</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('refugee', this)">üá∫üá¶ –î–ª—è –Ω–∞—à–∏—Ö</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('autoservice', this)">üõ† –ê–≤—Ç–æ</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('fuel', this)">‚õΩ –ê–ó–°</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('oilgas', this)">üõ¢ –ù–µ—Ñ—Ç—å</button>
                                    <button type="button" class="btn btn-outline-secondary rounded-pill border-0 bg-light px-3 py-2 quick-select-btn transition-all" onclick="selectJobCategory('other', this)">‚ú® –î—Ä—É–≥–æ–µ</button>
                                </div>
                            </div>

                            <div class="professions-grid">
                                {% for category, jobs in job_categories.items() %}
                                <div class="mb-4" data-category="{{ category }}">
                                    <h6 class="fw-bold text-primary mb-3 ps-2 border-start border-4 border-primary">{{ category }}</h6>
                                    <div class="row g-2">
                                        {% set outer_loop_index = loop.index0 %}
                                        {% for job in jobs %}
                                        <div class="col-md-6 col-lg-4">
                                            <div class="form-check custom-checkbox-tile">
                                                <input class="form-check-input job-checkbox" type="checkbox" name="selected_jobs" value="{{ job }}" id="job-{{ outer_loop_index }}-{{ loop.index0 }}">
                                                <label class="form-check-label w-100 p-2 rounded transition-all d-flex align-items-center cursor-pointer" for="job-{{ outer_loop_index }}-{{ loop.index0 }}">
                                                    <span class="custom-check-box me-2"></span>
                                                    {{ job }}
                                                </label>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="form-step-card bg-white p-4 p-md-5 rounded-5 shadow-soft mb-4 position-relative">
                            <div class="step-indicator">3</div>
                            <div class="text-center mb-4">
                                <h3 class="fw-bold">–ì–¥–µ –∏—Å–∫–∞—Ç—å?</h3>
                            </div>
                            <div class="row g-3">
                                {% for code, info in countries.items() %}
                                <div class="col-6 col-md-4">
                                    <label class="country-card h-100 cursor-pointer w-100">
                                        <input class="form-check-input d-none" type="checkbox" name="countries" value="{{ code }}" id="country_{{ code }}" {% if code in ['de', 'pl'] %}checked{% endif %}>
                                        <div class="country-content p-3 border rounded-4 text-center h-100 transition-all d-flex flex-column align-items-center justify-content-center">
                                            <span class="fs-1 mb-2 d-block">
                                                {% if code == 'de' %}üá©üá™{% elif code == 'pl' %}üáµüá±{% elif code == 'cz' %}üá®üáø{% elif code == 'gb' %}üá¨üáß{% elif code == 'fr' %}üá´üá∑{% elif code == 'it' %}üáÆüáπ{% elif code == 'es' %}üá™üá∏{% elif code == 'nl' %}üá≥üá±{% elif code == 'ch' %}üá®üá≠{% elif code == 'be' %}üáßüá™{% elif code == 'se' %}üá∏üá™{% elif code == 'no' %}üá≥üá¥{% elif code == 'us' %}üá∫üá∏{% elif code == 'ca' %}üá®üá¶{% else %}üåç{% endif %}
                                            </span>
                                            <span class="fw-medium">{{ info.name }}</span>
                                        </div>
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="form-step-card bg-white p-4 p-md-5 rounded-5 shadow-soft mb-4 position-relative">
                            <div class="step-indicator">4</div>
                            <div class="text-center mb-4">
                                <h3 class="fw-bold">–ì–æ—Ä–æ–¥ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</h3>
                            </div>
                            <div class="position-relative">
                                <i class="bi bi-geo-alt position-absolute text-muted fs-4" style="left: 20px; top: 50%; transform: translateY(-50%);"></i>
                                <input type="text" class="form-control form-control-lg border-2 rounded-pill ps-5 py-3 shadow-inset" name="city" data-i18n="attr=placeholder" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Berlin, –í–∞—Ä—à–∞–≤–∞..." style="font-size: 1.1rem;">
                            </div>
                            
                            <div class="mt-4 d-flex gap-3 align-items-start text-muted bg-light p-3 rounded-4">
                                <i class="bi bi-lightbulb-fill text-warning fs-5 flex-shrink-0"></i>
                                <div class="small">
                                    <strong>–°–æ–≤–µ—Ç:</strong> –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–µ. –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è (Berlin) —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ.
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3 mb-5">
                            <button type="submit" class="btn btn-primary btn-lg rounded-pill px-5 py-4 fs-4 fw-bold shadow-lg btn-glow w-100 w-md-auto transition-transform">
                                üöÄ –ù–∞–π—Ç–∏ —Ä–∞–±–æ—Ç—É
                            </button>

                            <div id="loading-message" class="mt-4" style="display: none; height: 0; opacity: 0; transition: all 0.5s ease;">
                                <div class="p-3 bg-white rounded-4 shadow-sm d-inline-block border">
                                    <div class="spinner-border text-primary me-2" role="status"></div>
                                    <span class="text-dark fw-medium">–°–∫–∞–Ω–∏—Ä—É–µ–º –±–∞–∑—ã –≤–∞–∫–∞–Ω—Å–∏–π...</span>
                                </div>
                            </div>

                            <div class="mt-5 pt-4 border-top">
                                <div class="row justify-content-center">
                                    <div class="col-md-8 col-lg-6">
                                        <h6 class="fw-bold mb-3">üì¨ –ù–æ–≤—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –Ω–∞ –ø–æ—á—Ç—É</h6>
                                        <div class="input-group shadow-sm rounded-pill overflow-hidden border">
                                            <input type="email" class="form-control border-0 ps-4" id="subscribe-email" placeholder="–í–∞—à email">
                                            <button class="btn btn-dark px-4" type="button" onclick="subscribeToEmails()">
                                                –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                                            </button>
                                        </div>
                                        <div class="mt-2">
                                            <a href="javascript:void(0)" onclick="showManageSubscriptionInfo(); return false;" class="text-muted small text-decoration-none hover-underline">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</main>

<script src="{{ url_for('static', filename='js/categories.js') }}"></script>
<script>
// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞—à—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ–¥–∏–Ω –≤ –æ–¥–∏–Ω
function selectJobCategory(category, buttonElement) {
    document.querySelectorAll('.quick-select-btn').forEach(btn => {
        // –ú–µ–Ω—è–µ–º –∫–ª–∞—Å—Å—ã –ø–æ–¥ –Ω–æ–≤—ã–π —Å—Ç–∏–ª—å (btn-dark –≤–º–µ—Å—Ç–æ btn-primary)
        btn.classList.remove('btn-dark', 'text-white', 'shadow-sm');
        btn.classList.add('btn-outline-secondary', 'bg-light');
    });
    // –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
    buttonElement.classList.remove('btn-outline-secondary', 'bg-light');
    buttonElement.classList.add('btn-dark', 'text-white', 'shadow-sm');

    document.querySelectorAll('.job-checkbox').forEach(cb => cb.checked = false);

    const baseMap = (window.CATEGORY_MAP || {});
    const jobsToSelect = baseMap[category] || [];

    if (!jobsToSelect.length) {
        showTemporaryMessage(`–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –¥–ª—è "${getReadableCategoryName(category)}" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`, 'warning');
        return;
    }

    let selectedCount = 0;
    document.querySelectorAll('.job-checkbox').forEach(checkbox => {
        if (jobsToSelect.includes(checkbox.value)) {
            checkbox.checked = true;
            selectedCount++;
        }
    });

    if (selectedCount > 0) {
        showTemporaryMessage(`–í—ã–±—Ä–∞–Ω–æ ${selectedCount} –ø—Ä–æ—Ñ–µ—Å—Å–∏–π –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${getReadableCategoryName(category)}"`, 'success');
    } else {
        showTemporaryMessage(`–ù–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ "${getReadableCategoryName(category)}"`, 'warning');
    }
}

function getReadableCategoryName(category) {
    const names = {
        'transport': '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', 'restaurant': '–û–±—â–µ–ø–∏—Ç', 'construction': '–°—Ç—Ä–æ–π–∫–∞',
        'care': '–£—Ö–æ–¥', 'it': 'IT', 'refugee': '–î–ª—è —É–∫—Ä–∞–∏–Ω—Ü–µ–≤', 'autoservice': '–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å',
        'fuel': '–ê–ó–°', 'oilgas': '–ù–µ—Ñ—Ç—å –∏ –≥–∞–∑', 'office': '–û—Ñ–∏—Å –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ'
    };
    return names[category] || category;
}

function showTemporaryMessage(message, type = 'info') {
    document.querySelectorAll('.temp-message').forEach(msg => msg.remove());
    const messageDiv = document.createElement('div');
    messageDiv.className = `alert alert-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'} temp-message shadow-lg border-0 rounded-4 px-4 py-3`;
    messageDiv.style.cssText = `position: fixed; top: 20px; right: 20px; z-index: 9999; animation: slideInRight 0.3s ease-out; max-width: 400px; font-weight: 500; background-color: ${type === 'success' ? '#d1e7dd' : '#fff3cd'};`;
    
    const icon = type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
    messageDiv.innerHTML = `<div class="d-flex align-items-center gap-2"><span>${icon}</span> <span>${message}</span></div>`;

    document.body.appendChild(messageDiv);
    setTimeout(() => {
        messageDiv.style.transition = 'opacity 0.3s, transform 0.3s';
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateX(100%)';
        setTimeout(() => messageDiv.remove(), 300);
    }, 3000);
}
</script>

<script src="{{ url_for('static', filename='app.js') }}"></script>
{% endblock %}