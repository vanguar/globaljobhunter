{% extends "layout.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ - GlobalJobHunter{% endblock %}

{% block content %}
<main>
    <section class="results-header">
        <div class="container">
            <h1 class="display-5 fw-bold mb-2">üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h1>
            <p class="lead text-muted">
                –ù–∞–π–¥–µ–Ω–æ {{ stats.total }} –≤–∞–∫–∞–Ω—Å–∏–π –∑–∞ {{ search_time }}—Å.
            </p>
            <a href="{{ url_for('index') }}" class="btn btn-outline-primary mt-3">
                <i class="bi bi-arrow-left me-2"></i>–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
            </a>
            <a href="/static/tg/webapp.html" class="btn btn-success ms-2" data-i18n="mini_version_title">Mini-–≤–µ—Ä—Å–∏—è –¥–ª—è Telegram</a>
        </div>
    </section>
    
    <section class="stats-container">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="stat-card h-100">
                        <div class="stat-icon" style="color: var(--primary-blue);"><i class="bi bi-briefcase-fill"></i></div>
                        <div class="stat-number">{{ stats.total }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π</div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stat-card h-100">
                        <div class="stat-icon" style="color: var(--success);"><i class="bi bi-house-heart-fill"></i></div>
                        <div class="stat-number">{{ stats.refugee_friendly }}</div>
                        <div class="stat-label">–î–ª—è –±–µ–∂–µ–Ω—Ü–µ–≤</div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stat-card h-100">
                        <div class="stat-icon" style="color: var(--info);"><i class="bi bi-volume-mute-fill"></i></div>
                        <div class="stat-number">{{ stats.no_language }}</div>
                        <div class="stat-label">–ë–µ–∑ –∑–Ω–∞–Ω–∏—è —è–∑—ã–∫–∞</div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stat-card h-100">
                        <div class="stat-icon" style="color: var(--warning);"><i class="bi bi-cash-coin"></i></div>
                        <div class="stat-number">{{ stats.with_salary }}</div>
                        <div class="stat-label">–° —É–∫–∞–∑–∞–Ω–∏–µ–º –∑–∞—Ä–ø–ª–∞—Ç—ã</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="pb-5">
        <div class="container">
            <div class="filter-bar sticky-top mb-4">
                <div class="row g-3 align-items-center">
                    <!-- –ü–æ–∏—Å–∫ -->
                    <div class="col-lg-4">
                        <div class="input-group">
                             <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                             <input type="text" class="form-control" id="job-filter" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–æ–º–ø–∞–Ω–∏–∏..." data-i18n="attr=placeholder">
                        </div>
                    </div>

                    <!-- –ù–æ–≤—ã–µ —Å–µ–ª–µ–∫—Ç—ã -->
                    <div class="col-lg-8">
                        <div class="row g-2">
                            <div class="col-sm-4">
                                <select id="filter-date" class="form-select">
                                    <option value="any" data-i18n="–î–∞—Ç–∞: –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è">–î–∞—Ç–∞: –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è</option>
                                    <option value="1" data-i18n="–ó–∞ 24 —á–∞—Å–∞">–ó–∞ 24 —á–∞—Å–∞</option>
                                    <option value="3" data-i18n="–ó–∞ 3 –¥–Ω—è">–ó–∞ 3 –¥–Ω—è</option>
                                    <option value="7" data-i18n="–ó–∞ 7 –¥–Ω–µ–π">–ó–∞ 7 –¥–Ω–µ–π</option>
                                    <option value="14" data-i18n="–ó–∞ 14 –¥–Ω–µ–π">–ó–∞ 14 –¥–Ω–µ–π</option>
                                    <option value="30" data-i18n="–ó–∞ 30 –¥–Ω–µ–π">–ó–∞ 30 –¥–Ω–µ–π</option>
                                </select>
                            </div>
                            <div class="col-sm-4">
                                <select id="filter-emp" class="form-select">
                                    <option value="any" data-i18n="–¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏: –ª—é–±–æ–π">–¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏: –ª—é–±–æ–π</option>
                                    <option value="full-time">Full-time</option>
                                    <option value="part-time">Part-time</option>
                                    <option value="contract">Contract</option>
                                    <option value="temporary">Temporary</option>
                                    <option value="internship">Internship</option>
                                </select>
                            </div>
                            <div class="col-sm-4">
                                <select id="filter-remote" class="form-select">
                                    <option value="any" data-i18n="–§–æ—Ä–º–∞—Ç: –ª—é–±–æ–π">–§–æ—Ä–º–∞—Ç: –ª—é–±–æ–π</option>
                                    <option value="remote">Remote</option>
                                    <option value="hybrid">Hybrid</option>
                                    <option value="onsite">Onsite</option>
                                </select>
                            </div>
                        </div>

                        <!-- –ë–∞–∑–æ–≤—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ -->
                        <div class="btn-group w-100 mt-2" role="group">
                            <input type="radio" class="btn-check" name="filter-type" id="all" value="all" checked>
                            <label class="btn btn-outline-primary" for="all" data-i18n="–í—Å–µ"><i class="bi bi-list-ul me-1"></i>–í—Å–µ</label>
                            
                            <input type="radio" class="btn-check" name="filter-type" id="refugees" value="refugees">
                            <label class="btn btn-outline-primary" for="refugees" data-i18n="–¢–æ–ª—å–∫–æ –¥–ª—è –±–µ–∂–µ–Ω—Ü–µ–≤"><i class="bi bi-house-heart me-1"></i>–¢–æ–ª—å–∫–æ –¥–ª—è –±–µ–∂–µ–Ω—Ü–µ–≤</label>
                            
                            <input type="radio" class="btn-check" name="filter-type" id="no-lang" value="no-lang">
                            <label class="btn btn-outline-primary" for="no-lang" data-i18n="–¢–æ–ª—å–∫–æ –±–µ–∑ —è–∑—ã–∫–∞"><i class="bi bi-volume-mute me-1"></i>–¢–æ–ª—å–∫–æ –±–µ–∑ —è–∑—ã–∫–∞</label>
                        </div>

                        <!-- –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                        <div class="d-flex justify-content-end mt-2">
                            <button id="filter-reset" type="button" class="btn btn-light border" data-i18n="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã">
                                <i class="bi bi-arrow-counterclockwise me-1"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGINATION BAR -->
            <div id="gjh-pager" class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
            <div class="d-flex align-items-center gap-2">
                <label for="gjh-per-page" class="text-muted small" data-i18n="–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:">–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
                <select id="gjh-per-page" class="form-select form-select-sm" style="width:auto;">
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="150" selected>150</option>
                <option value="250">250</option>
                <option value="500">500</option>
                </select>
            </div>
            <div class="d-flex align-items-center gap-2">
                <button id="gjh-prev" class="btn btn-outline-secondary btn-sm" data-i18n="‚Üê –ù–∞–∑–∞–¥" disabled>‚Üê –ù–∞–∑–∞–¥</button>
                <span id="gjh-page-label" class="small text-muted" data-i18n="–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 1</span>
                <button id="gjh-next" class="btn btn-outline-secondary btn-sm" data-i18n="–í–ø–µ—Ä—ë–¥ ‚Üí" disabled>–í–ø–µ—Ä—ë–¥ ‚Üí</button>
            </div>
            <!-- ‚Üì‚Üì‚Üì NUDGE: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–¥–ø–∏—Å–∫–µ ‚Üì‚Üì‚Üì -->
            <div id="pager-subscribe" class="w-100 mt-2 pt-2 border-top">
            <button id="pager-subscribe-btn" type="button" class="pager-nudge-btn" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–¥–ø–∏—Å–∫–µ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏–∏">
                <span class="nudge-arrow" aria-hidden="true">‚Üì</span>
                <span class="nudge-text" data-i18n="–ü–æ–ª—É—á–∞—Ç—å –∂–µ–ª–∞–µ–º—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –Ω–∞ email">–ü–æ–ª—É—á–∞—Ç—å –∂–µ–ª–∞–µ–º—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –Ω–∞ email</span>
            </button>
            </div>
            <!-- ‚Üë‚Üë‚Üë /NUDGE ‚Üë‚Üë‚Üë -->

            </div>


            <div id="jobs-container">
                {% if jobs_by_country %}
                    {% for country_name, country_jobs in jobs_by_country.items() %}
                        <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Å—Ç—Ä–∞–Ω—ã -->
                        <div class="country-divider" data-country="{{ country_name }}">
                            <div class="country-header">
                                <div class="country-flag">
                                    {% if country_name == '–ì–µ—Ä–º–∞–Ω–∏—è' %}üá©üá™
                                    {% elif country_name == '–ü–æ–ª—å—à–∞' %}üáµüá±
                                    {% elif country_name == '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è' %}üá¨üáß
                                    {% elif country_name == '–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã' %}üá≥üá±
                                    {% elif country_name == '–§—Ä–∞–Ω—Ü–∏—è' %}üá´üá∑
                                    {% elif country_name == '–ê–≤—Å—Ç—Ä–∏—è' %}üá¶üáπ
                                    {% elif country_name == '–°–®–ê' %}üá∫üá∏
                                    {% elif country_name == '–ö–∞–Ω–∞–¥–∞' %}üá®üá¶
                                    {% elif country_name == '–ê–≤—Å—Ç—Ä–∞–ª–∏—è' %}üá¶üá∫
                                    {% elif country_name == '–ò—Ç–∞–ª–∏—è' %}üáÆüáπ
                                    {% elif country_name == '–ò—Å–ø–∞–Ω–∏—è' %}üá™üá∏
                                    {% elif country_name == '–®–≤–µ–π—Ü–∞—Ä–∏—è' %}üá®üá≠
                                    {% elif country_name == '–ë–µ–ª—å–≥–∏—è' %}üáßüá™
                                    {% elif country_name == '–®–≤–µ—Ü–∏—è' %}üá∏üá™
                                    {% elif country_name == '–ù–æ—Ä–≤–µ–≥–∏—è' %}üá≥üá¥
                                    {% elif country_name == '–î–∞–Ω–∏—è' %}üá©üá∞
                                    {% elif country_name == '–ß–µ—Ö–∏—è' %}üá®üáø
                                    {% elif country_name == '–°–ª–æ–≤–∞–∫–∏—è' %}üá∏üá∞
                                    {% else %}üåç{% endif %}
                                </div>
                                <div class="country-info">
                                    <h3 class="country-name">{{ country_name }}</h3>
                                    <p class="country-stats">{{ country_jobs|length }} –≤–∞–∫–∞–Ω—Å–∏–π</p>
                                </div>
                                <div class="country-line"></div>
                            </div>
                        </div>

                        <!-- –í–∞–∫–∞–Ω—Å–∏–∏ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω—ã -->
                        {% for job in country_jobs %}
                        {% set _text = ((job.title or '') ~ ' ' ~ (job.description or '') ~ ' ' ~ (job.location or '')) | lower %}
                        {% set emp = 'unknown' %}
                        {% if 'full time' in _text or 'full-time' in _text or 'vollzeit' in _text %}
                          {% set emp = 'full-time' %}
                        {% elif 'part time' in _text or 'part-time' in _text or 'teilzeit' in _text %}
                          {% set emp = 'part-time' %}
                        {% elif 'contract' in _text or 'freelance' in _text %}
                          {% set emp = 'contract' %}
                        {% elif 'temporary' in _text or 'befristet' in _text %}
                          {% set emp = 'temporary' %}
                        {% elif 'intern' in _text or 'praktik' in _text %}
                          {% set emp = 'internship' %}
                        {% endif %}
                        {% set remote = 'onsite' %}
                        {% if 'remote' in _text or 'home office' in _text or 'home-office' in _text or 'wfh' in _text or '—É–¥–∞–ª–µ–Ω' in _text or '–≤—ñ–¥–¥–∞–ª–µ–Ω' in _text %}
                          {% set remote = 'remote' %}
                        {% elif 'hybrid' in _text or 'teil-remote' in _text or 'hybrid-' in _text %}
                          {% set remote = 'hybrid' %}
                        {% endif %}

                        <div class="job-card" 
                             data-refugee="{{ job.refugee_friendly|lower }}" 
                             data-no-language="{{ (job.language_requirement == 'no_language_required')|lower }}"
                             data-country="{{ country_name }}"
                             data-emp="{{ emp }}"
                             data-remote="{{ remote }}"
                             data-posted-iso="{{ job.posted_date.split('T')[0] if job.posted_date }}">
                            <div class="row g-3">
                                <div class="col-lg-8">
                                    <div class="d-flex align-items-start mb-3">
                                        <div>
                                            <h5 class="job-title mb-1">{{ job.title }}</h5>
                                            <p class="company-name mb-2">{{ job.company }}</p>
                                        </div>
                                    </div>
                                    <div class="job-meta mb-3">
                                        <span><i class="bi bi-geo-alt-fill me-2"></i>{{ job.location }}</span>
                                        <span><i class="bi bi-calendar3 me-2"></i>{{ job.posted_date.split('T')[0] }}</span>
                                        <span class="source-badge">
                                            <i class="bi bi-database me-1"></i>{{ job.source }}
                                        </span>
                                    </div>
                                    {% if job.description %}
                                        <p class="job-description">{{ job.description | striptags }}</p>
                                    {% endif %}
                                    <div class="d-flex flex-wrap gap-2">
                                        {% if emp != 'unknown' %}<span class="badge bg-light text-dark border">{{ emp }}</span>{% endif %}
                                        <span class="badge bg-light text-dark border">{{ remote }}</span>
                                        {% if job.refugee_friendly %}<span class="badge bg-success-subtle text-success-emphasis border" data-i18n="–¥–ª—è –±–µ–∂–µ–Ω—Ü–µ–≤"><i class="bi bi-house-heart"></i> –¥–ª—è –±–µ–∂–µ–Ω—Ü–µ–≤</span>{% endif %}
                                        {% if job.language_requirement == 'no_language_required' %}<span class="badge bg-info-subtle text-info-emphasis border" data-i18n="–±–µ–∑ —è–∑—ã–∫–∞"><i class="bi bi-volume-mute"></i> –±–µ–∑ —è–∑—ã–∫–∞</span>{% endif %}
                                    </div>
                                </div>
                                <div class="col-lg-4 d-flex flex-column justify-content-between align-items-lg-end">
                                    <div class="w-100">
                                        {% if job.salary %}
                                            <div class="salary-badge mt-2">{{ job.salary|safe }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="mt-3 w-100 d-grid gap-2">
                                         <a href="{{ url_for('analytics.outbound',
                                                            u=job.apply_url,
                                                            partner=job.source,
                                                            job_id=job.id,
                                                            title=job.title) }}"
                                            target="_blank" rel="noopener" class="btn btn-primary">
                                            –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è <i class="bi bi-box-arrow-up-right ms-2"></i>
                                         </a>

                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                                onclick="copyToClipboard(`{{ url_for('analytics.outbound',
                                                                                    u=job.apply_url,
                                                                                    partner=job.source,
                                                                                    job_id=job.id,
                                                                                    title=job.title) }}`)">
                                        <i class="bi bi-clipboard me-1"></i>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                                        </button>

                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% endfor %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-binoculars-fill text-muted" style="font-size: 5rem;"></i>
                        <h3 class="mt-4" data-i18n="–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ">–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p class="text-muted" data-i18n="–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ–∏—é –ø–æ–∏—Å–∫–∞.">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ–∏—é –ø–æ–∏—Å–∫–∞.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </section>

<!-- –ë–ª–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
<section class="support-promo-section py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="support-promo-card text-center" style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-radius: 20px; padding: 40px; border: 2px solid #e1f5fe;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">üíô</div>
                    <h3 style="color: #1976D2; font-weight: 600; margin-bottom: 15px;">–ü–æ–Ω—Ä–∞–≤–∏–ª—Å—è –ø—Ä–æ–µ–∫—Ç?</h3>
                    <p class="text-muted mb-4">–í–∞—à–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç —Å–∞–π—Ç—É —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è. –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –º–æ–∂–Ω–æ –ø–æ–º–æ—á—å –∏ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∞–≤—Ç–æ—Ä–æ–º.</p>
                    <a href="/support" class="btn btn-primary btn-lg" style="border-radius: 12px; padding: 12px 30px; font-weight: 600;">
                        –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>    

<!-- –ü–æ–¥–ø–∏—Å–∫–∞ -->
<section id="job-alerts" class="subscription-section py-5 border-top">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="text-center">
                    <h4 class="mb-3">üìß –ü–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –Ω–∞ email</h4>
                    <p class="text-muted mb-4">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∞–∫–∞–Ω—Å–∏—è—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –ø–æ–∏—Å–∫–∞</p>
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="input-group input-group-lg">
                                <input type="email" class="form-control" id="subscribe-email" placeholder="–í–∞—à email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π">
                                <button class="btn btn-primary" type="button" onclick="subscribeToEmails()">
                                    <i class="bi bi-envelope me-1"></i>–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
                                </button>
                            </div>
                            <small class="text-muted mt-2 d-block">
                                <i class="bi bi-shield-check me-1"></i>–ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –±–µ–∑ —Å–ø–∞–º–∞
                            </small>
                            <small class="text-muted">
                                <a href="javascript:void(0)" onclick="showManageSubscriptionInfo()" class="text-decoration-none">
                                    ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π
                                </a>
                            </small>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="feature-item">
                                <i class="bi bi-bell text-primary mb-2 d-block" style="font-size: 1.5rem;"></i>
                                <small class="text-muted">–ù–æ–≤—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –ø–µ—Ä–≤—ã–º–∏</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="feature-item">
                                <i class="bi bi-gear text-primary mb-2 d-block" style="font-size: 1.5rem;"></i>
                                <small class="text-muted">–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="feature-item">
                                <i class="bi bi-x-circle text-primary mb-2 d-block" style="font-size: 1.5rem;"></i>
                                <small class="text-muted">–õ–µ–≥–∫–∞—è –æ—Ç–ø–∏—Å–∫–∞</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

</main>
{% endblock %}

{% block scripts %}
<script defer src="{{ url_for('static', filename='js/localization.js') }}"></script>
<script>
/* ======= –ù–æ–≤—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ ======= */
document.getElementById('job-filter').addEventListener('input', filterJobs);
document.querySelectorAll('input[name="filter-type"]').forEach(radio => radio.addEventListener('change', filterJobs));
['filter-date','filter-emp','filter-remote'].forEach(id => {
  const el = document.getElementById(id);
  if (el) {
    el.addEventListener('change', filterJobs);
    el.addEventListener('input', filterJobs);
  }
});
const resetBtn = document.getElementById('filter-reset');
if (resetBtn){
  resetBtn.addEventListener('click', () => {
    const q = document.getElementById('job-filter'); if (q) q.value = '';
    const d = document.getElementById('filter-date'); if (d) d.value = 'any';
    const e = document.getElementById('filter-emp'); if (e) e.value = 'any';
    const r = document.getElementById('filter-remote'); if (r) r.value = 'any';
    const all = document.getElementById('all'); if (all) all.checked = true;
    filterJobs();
  });
}

/* ======= –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ======= */
function daysBetween(iso){
  if (!iso) return 9999;
  const d = new Date(iso + 'T00:00:00Z');
  const now = new Date();
  return Math.floor((now - d)/86400000);
}
function matchDate(card, val){
  if (val === 'any') return true;
  const maxDays = parseInt(val, 10);
  return daysBetween(card.dataset.postedIso || '') <= maxDays;
}
function matchEmp(card, val){
  if (val === 'any') return true;
  return (card.dataset.emp || 'unknown') === val;
}
function matchRemote(card, val){
  if (val === 'any') return true;
  return (card.dataset.remote || 'onsite') === val;
}

/* ======= –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä ======= */
function filterJobs() {
  const searchTerm = (document.getElementById('job-filter').value || '').toLowerCase().trim();
  const filterType = document.querySelector('input[name="filter-type"]:checked')?.value || 'all';
  const dateVal    = document.getElementById('filter-date')?.value || 'any';
  const empVal     = document.getElementById('filter-emp')?.value || 'any';
  const remoteVal  = document.getElementById('filter-remote')?.value || 'any';

  const jobCards = document.querySelectorAll('.job-card');
  const countryDividers = document.querySelectorAll('.country-divider');

  let visibleCount = 0;
  const visibleCountries = new Set();

  jobCards.forEach(card => {
      const title = card.querySelector('.job-title')?.textContent.toLowerCase() || '';
      const company = card.querySelector('.company-name')?.textContent.toLowerCase() || '';
      const country = card.dataset.country || '';

      const matchesSearch = !searchTerm || title.includes(searchTerm) || company.includes(searchTerm);

      let matchesFilter = true;
      if (filterType === 'refugees') {
          matchesFilter = card.dataset.refugee === 'true';
      } else if (filterType === 'no-lang') {
          matchesFilter = card.dataset.noLanguage === 'true';
      }

      const okDate   = matchDate(card, dateVal);
      const okEmp    = matchEmp(card,  empVal);
      const okRemote = matchRemote(card, remoteVal);

      const show = matchesSearch && matchesFilter && okDate && okEmp && okRemote;

      card.style.display = show ? 'block' : 'none';
      if (show) {
         visibleCount++;
         visibleCountries.add(country);
      }
  });

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Å—Ç—Ä–∞–Ω
  countryDividers.forEach(divider => {
      divider.style.display = visibleCountries.has(divider.dataset.country) ? 'block' : 'none';
  });

  updateResultsCount(visibleCount, jobCards.length);
}

/* ======= –°—á—ë—Ç—á–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –±—ã–ª) ======= */
function updateResultsCount(count, total) {
   let counterElement = document.getElementById('results-counter');
   const jobsContainer = document.getElementById('jobs-container');
   
   if (!counterElement) {
       counterElement = document.createElement('div');
       counterElement.id = 'results-counter';
       jobsContainer.insertBefore(counterElement, jobsContainer.firstChild);
   }
   
   if (count === total) {
       if (counterElement) counterElement.remove();
       return;
   }
   
   counterElement.className = 'alert alert-info mt-3';
   counterElement.innerHTML = `<i class="bi bi-info-circle me-2"></i>–ü–æ–∫–∞–∑–∞–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π: <strong>${count} –∏–∑ ${total}</strong>`;
   
   if (count === 0) {
       counterElement.className = 'alert alert-warning mt-3';
       counterElement.innerHTML = `<i class="bi bi-exclamation-triangle me-2"></i>–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–∞–º`;
   }
}

// ======= –ü–ê–ì–ò–ù–ê–¶–ò–Ø / –í–ò–†–¢–£–ê–õ–ò–ó–ê–¶–ò–Ø (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏) =======
(() => {
  // –°–æ—Ö—Ä–∞–Ω–∏–º —Å—Ç–∞—Ä—É—é —Ñ—É–Ω–∫—Ü–∏—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–Ω–∏–º–µ–º —Å—Ç–∞—Ä—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏,
  // —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –¥–µ—Ä–≥–∞–ª–∏ "—Ç—è–∂—ë–ª—É—é" DOM-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é.
  const oldFilterJobs = window.filterJobs;

  function detachOldListeners(){
    const q = document.getElementById('job-filter');
    if (q && typeof oldFilterJobs === 'function') {
      q.removeEventListener('input', oldFilterJobs);
    }
    document.querySelectorAll('input[name="filter-type"]').forEach(r => {
      if (typeof oldFilterJobs === 'function') r.removeEventListener('change', oldFilterJobs);
    });
    ['filter-date','filter-emp','filter-remote'].forEach(id => {
      const el = document.getElementById(id);
      if (el && typeof oldFilterJobs === 'function') el.removeEventListener('change', oldFilterJobs);
    });
  }

  let ALL = [];                 // [{el, country}]
  let FILTERED = [];
  const COUNTRY_HEADERS = new Map();
  let ORDERED_COUNTRIES = [];
  let PAGE = 1;
  let PER_PAGE = 150;

  const jobsContainer = document.getElementById('jobs-container');
  const perPageSel = document.getElementById('gjh-per-page');
  const btnPrev = document.getElementById('gjh-prev');
  const btnNext = document.getElementById('gjh-next');
  const pageLabel = document.getElementById('gjh-page-label');

  function paginateInit(){
    if (!jobsContainer) return;

    // –û—Ç—Ü–µ–ø–∏–º —Å—Ç–∞—Ä—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏ –¥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è filterJobs
    detachOldListeners();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Å—Ç—Ä–∞–Ω –∏ –ø–æ—Ä—è–¥–æ–∫
    const headers = Array.from(jobsContainer.querySelectorAll('.country-divider'));
    ORDERED_COUNTRIES = headers.map(h => h.dataset.country || '');
    headers.forEach(h => {
    // –°–±—Ä–æ—Å –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –ø—Ä–µ–∂–Ω–µ–≥–æ display:none
    h.style.removeProperty('display');
    COUNTRY_HEADERS.set(h.dataset.country || '', h);
    });

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
    const cards = Array.from(jobsContainer.querySelectorAll('.job-card'));
    cards.forEach(el => {
    // –°–±—Ä–æ—Å –ø—Ä–µ–∂–Ω–∏—Ö –∏–Ω–ª–∞–π–Ω–æ–≤—ã—Ö —Å–∫—Ä—ã—Ç–∏–π –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
    el.style.removeProperty('display');
    el.hidden = false;
    });
    ALL = cards.map(el => ({ el, country: el.dataset.country || '' }));

    // –£–±–∏—Ä–∞–µ–º –≤—Å—ë –∏–∑ DOM ‚Äî –±—É–¥–µ–º –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ
    jobsContainer.innerHTML = '';


    // –û–ø—Ä–µ–¥–µ–ª–∏–º "–ø—Ä–æ–∫—Å–∏" –Ω–∞–¥ —Ç–≤–æ–∏–º–∏ match-—Ñ—É–Ω–∫—Ü–∏—è–º–∏ (–µ—Å–ª–∏ –∏—Ö –≤–¥—Ä—É–≥ –ø–µ—Ä–µ–∏–º–µ–Ω—É—é—Ç, –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —É–ø–∞–¥—ë–º)
    const _matchDate   = (card, v) => (typeof window.matchDate   === 'function') ? window.matchDate(card.el, v)   : true;
    const _matchEmp    = (card, v) => (typeof window.matchEmp    === 'function') ? window.matchEmp(card.el, v)    : true;
    const _matchRemote = (card, v) => (typeof window.matchRemote === 'function') ? window.matchRemote(card.el, v) : true;

    // –ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è filterJobs ‚Äî —Ñ–∏–ª—å—Ç—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –≤ –ø–∞–º—è—Ç–∏ –∏ —Ä–∏—Å—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    window.filterJobs = function() { applyFilters(false); };

    function applyFilters(forceToFirstPage){
      const searchTerm = (document.getElementById('job-filter')?.value || '').toLowerCase().trim();
      const filterType = document.querySelector('input[name="filter-type"]:checked')?.value || 'all';
      const dateVal    = document.getElementById('filter-date')?.value || 'any';
      const empVal     = document.getElementById('filter-emp')?.value || 'any';
      const remoteVal  = document.getElementById('filter-remote')?.value || 'any';

      FILTERED = ALL.filter(card => {
        const title   = card.el.querySelector('.job-title')?.textContent.toLowerCase() || '';
        const company = card.el.querySelector('.company-name')?.textContent.toLowerCase() || '';
        const matchesSearch = !searchTerm || title.includes(searchTerm) || company.includes(searchTerm);

        let matchesFlag = true;
        if (filterType === 'refugees') matchesFlag = (card.el.dataset.refugee === 'true');
        else if (filterType === 'no-lang') matchesFlag = (card.el.dataset.noLanguage === 'true');

        return matchesSearch && matchesFlag && _matchDate(card, dateVal) && _matchEmp(card, empVal) && _matchRemote(card, remoteVal);
      });

      if (forceToFirstPage) PAGE = 1;
      else if (PAGE > totalPages()) PAGE = totalPages() || 1;

      render();
    }

    function totalPages(){ return Math.max(1, Math.ceil(FILTERED.length / PER_PAGE)); }

    function render(){
      jobsContainer.innerHTML = '';

      const start = (PAGE - 1) * PER_PAGE;
      const end   = start + PER_PAGE;
      const slice = FILTERED.slice(start, end);

      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Å—Ç—Ä–∞–Ω–∞–º, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ—Ä—è–¥–æ–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π
      const onPageCountries = new Set(slice.map(x => x.country));
      ORDERED_COUNTRIES.forEach(country => {
        if (!onPageCountries.has(country)) return;

        const header = COUNTRY_HEADERS.get(country);
        if (header) {
            header.style.removeProperty('display'); // –Ω–∞ –≤—Å—è–∫–∏–π
            jobsContainer.appendChild(header);
        }

        slice.forEach(item => {
            if (item.country === country) {
            // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –æ—á–∏—â–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏–Ω–ª–∞–π–Ω–æ–≤—ã–µ —Å–∫—Ä—ã—Ç–∏—è
            item.el.style.removeProperty('display');
            item.el.hidden = false;
            jobsContainer.appendChild(item.el);
            }
        });
        });


      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å
      const tp = totalPages();
      if (pageLabel) pageLabel.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${PAGE} –∏–∑ ${tp}`;
      if (btnPrev) btnPrev.disabled = (PAGE <= 1);
      if (btnNext) btnNext.disabled = (PAGE >= tp);

      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–≤–æ–π —Å—á—ë—Ç—á–∏–∫ (—É —Ç–µ–±—è –æ–Ω –Ω–∞ —Å—Ç—Ä–æ–∫–∞—Ö 424‚Äì448)
      if (typeof window.updateResultsCount === 'function') {
        window.updateResultsCount(FILTERED.length, ALL.length);
      }
      // –ü–ª–∞–≤–Ω—ã–π –ø–æ–¥—ä—ë–º –Ω–∞–≤–µ—Ä—Ö –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      if ('scrollBehavior' in document.documentElement.style) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        window.scrollTo(0, 0);
      }
      
    }

    // –ù–∞–≤–µ—Å–∏–º –°–í–û–ò —Å–ª—É—à–∞—Ç–µ–ª–∏ –Ω–∞ –Ω–æ–≤—É—é filterJobs
    const q = document.getElementById('job-filter');
    if (q) q.addEventListener('input', window.filterJobs);
    document.querySelectorAll('input[name="filter-type"]').forEach(r => r.addEventListener('change', window.filterJobs));
    ['filter-date','filter-emp','filter-remote'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.addEventListener('change', window.filterJobs);
    });

    // –ü–∞–Ω–µ–ª—å –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    perPageSel?.addEventListener('change', () => {
      PER_PAGE = parseInt(perPageSel.value, 10) || 150;
      PAGE = 1;
      render();
    });
    btnPrev?.addEventListener('click', () => { if (PAGE > 1) { PAGE--; render(); } });
    btnNext?.addEventListener('click', () => { if (PAGE < Math.max(1, Math.ceil(FILTERED.length / PER_PAGE))) { PAGE++; render(); } });

    // –ü–µ—Ä–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Ä–µ–Ω–¥–µ—Ä
    applyFilters(true);
  }

  // –°—Ç–∞—Ä—Ç—É–µ–º –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤–µ—Å—å DOM –∏ —Ç–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —É–∂–µ –æ–±—ä—è–≤–ª–µ–Ω—ã
  document.addEventListener('DOMContentLoaded', paginateInit, { once: true });
})();

/* ======= –û—Å—Ç–∞–ª—å–Ω–æ–π –≤–∞—à –∫–æ–¥: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–æ—Å—Ç—ã, –ø–æ–¥–ø–∏—Å–∫–∏, —Å—Ç–∞—Ç—É—Å ======= */
function copyToClipboard(text) {
   navigator.clipboard.writeText(text).then(() => {
       showToast('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
   }).catch(() => {
       showToast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 'danger');
   });
}
function showToast(message, type = 'info') {
   const toastContainer = document.getElementById('toast-container') || createToastContainer();
   const toast = document.createElement('div');
   toast.className = `alert alert-${type} alert-dismissible fade show m-0`;
   toast.setAttribute('role', 'alert');
   toast.style.minWidth = '250px';
   toast.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
   toastContainer.appendChild(toast);
   const bsAlert = new bootstrap.Alert(toast);
   setTimeout(() => bsAlert.close(), 3000);
}
function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toast-container';
    container.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1056;';
    document.body.appendChild(container);
    return container;
}
function subscribeToEmails() {
    const emailInput = document.getElementById('subscribe-email');
    const email = emailInput.value.trim();
    if (!email || !email.includes('@')) {
        showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å', 'warning');
        return;
    }
    fetch('/subscribe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email })
    })
    .then(response => {
        if (response.status === 409) {
            return response.json().then(data => {
                showSubscriptionChoiceModal(email, data);
                throw new Error('HANDLED_409');
            });
        } else if (response.ok) {
            return response.json();
        } else {
            return response.json().then(data => {
                throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏');
            });
        }
    })
    .then(data => {
        showToast('‚úÖ ' + data.message, 'success');
        emailInput.value = '';
    })
    .catch(error => {
        if (error.message === 'HANDLED_409') return;
        console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏:', error);
        showToast('‚ùå ' + error.message, 'danger');
    });
}
function showManageSubscriptionInfo() {
    alert('üìß –°—Å—ã–ª–∫–∞ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π –±—É–¥–µ—Ç –≤ –∫–∞–∂–¥–æ–º email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏!\n\n–í—ã —Å–º–æ–∂–µ—Ç–µ:\n‚Ä¢ –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏\n‚Ä¢ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–∞–Ω—ã\n‚Ä¢ –ò–∑–º–µ–Ω–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n‚Ä¢ –û—Ç–ø–∏—Å–∞—Ç—å—Å—è');
}
function checkSystemStatus() {
    fetch('/health')
        .then(response => {
            if (response.ok) return response.text();
            throw new Error('–°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        })
        .then(html => {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'status-modal';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <iframe srcdoc="${html.replace(/"/g, '&quot;')}" style="width: 100%; height: 400px; border: none;"></iframe>
                        </div>
                    </div>
                </div>`;
            document.body.appendChild(modal);
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
            modal.addEventListener('hidden.bs.modal', () => modal.remove());
        })
        .catch(error => alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞: ' + error.message));
}
function showSubscriptionChoiceModal(email, data) {
    if (!data || !data.current_subscription || !data.new_subscription) {
        showToast('‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–∫–∏', 'danger'); return;
    }
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'subscription-choice-modal';
    const currentJobs = data.current_subscription.jobs.slice(0, 3).join(', ') + 
                       (data.current_subscription.jobs.length > 3 ? ` (+${data.current_subscription.jobs.length - 3})` : '');
    const newJobs = data.new_subscription.jobs.slice(0, 3).join(', ') + 
                   (data.new_subscription.jobs.length > 3 ? ` (+${data.new_subscription.jobs.length - 3})` : '');
    modal.innerHTML = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="border: none; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.2);">
                <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 20px 20px 0 0; padding: 25px;">
                    <div class="d-flex align-items-center">
                        <div class="me-3" style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-envelope-heart" style="font-size: 1.5rem;"></i>
                        </div>
                        <div>
                            <h4 class="modal-title mb-1" style="font-weight: 600;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π</h4>
                            <small style="opacity: 0.9;">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–∞—à–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" style="filter: brightness(0) invert(1);"></button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <div class="alert alert-info" style="border: none; background: linear-gradient(45deg, #e3f2fd, #f3e5f5); border-radius: 15px; border-left: 4px solid #2196F3;">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —ç—Ç–æ—Ç email!</strong>
                        <br><small class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫ –ø–æ—Å—Ç—É–ø–∏—Ç—å —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–∏—Å–∫–∞</small>
                    </div>
                    <div class="row g-4 mt-2">
                        <div class="col-md-6">
                            <div class="subscription-card current" style="background: linear-gradient(135deg, #f8f9ff 0%, #e8f4fd 100%); border: 2px solid #e3f2fd; border-radius: 15px; padding: 20px; height: 100%; position: relative;">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="subscription-icon" style="background: #2196F3; color: white; border-radius: 10px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                        <i class="bi bi-bookmark-check"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0" style="color: #2196F3; font-weight: 600;">–¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</h6>
                                        <small class="text-muted">–î–µ–π—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</small>
                                    </div>
                                </div>
                                <div class="subscription-details">
                                    <div class="detail-item mb-2">
                                        <i class="bi bi-briefcase text-primary me-2"></i>
                                        <small><strong>–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏:</strong></small>
                                        <div class="ms-4"><small class="text-muted">${currentJobs}</small></div>
                                    </div>
                                    <div class="detail-item mb-2">
                                        <i class="bi bi-globe text-primary me-2"></i>
                                        <small><strong>–°—Ç—Ä–∞–Ω—ã:</strong></small>
                                        <div class="ms-4"><small class="text-muted">${data.current_subscription.countries.join(', ')}</small></div>
                                    </div>
                                    <div class="detail-item">
                                        <i class="bi bi-geo-alt text-primary me-2"></i>
                                        <small><strong>–ì–æ—Ä–æ–¥:</strong></small>
                                        <div class="ms-4"><small class="text-muted">${data.current_subscription.city || '–ù–µ —É–∫–∞–∑–∞–Ω'}</small></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="subscription-card new" style="background: linear-gradient(135deg, #f0fff4 0%, #e8f5e8 100%); border: 2px solid #e8f5e8; border-radius: 15px; padding: 20px; height: 100%; position: relative;">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="subscription-icon" style="background: #4CAF50; color: white; border-radius: 10px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                        <i class="bi bi-bookmark-plus"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0" style="color: #4CAF50; font-weight: 600;">–ù–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</h6>
                                        <small class="text-muted">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –ø–æ–∏—Å–∫–∞</small>
                                    </div>
                                </div>
                                <div class="subscription-details">
                                    <div class="detail-item mb-2">
                                        <i class="bi bi-briefcase text-success me-2"></i>
                                        <small><strong>–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏:</strong></small>
                                        <div class="ms-4"><small class="text-muted">${newJobs}</small></div>
                                    </div>
                                    <div class="detail-item mb-2">
                                        <i class="bi bi-globe text-success me-2"></i>
                                        <small><strong>–°—Ç—Ä–∞–Ω—ã:</strong></small>
                                        <div class="ms-4"><small class="text-muted">${data.new_subscription.countries.join(', ')}</small></div>
                                    </div>
                                    <div class="detail-item">
                                        <i class="bi bi-geo-alt text-success me-2"></i>
                                        <small><strong>–ì–æ—Ä–æ–¥:</strong></small>
                                        <div class="ms-4"><small class="text-muted">${data.new_subscription.city || '–ù–µ —É–∫–∞–∑–∞–Ω'}</small></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <h6 class="mb-3" style="color: #666;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</h6>
                    </div>
                </div>
                <div class="modal-footer" style="border: none; padding: 20px 30px 30px; gap: 15px;">
                    <button type="button" class="btn btn-outline-secondary flex-fill" data-bs-dismiss="modal" style="border-radius: 12px; padding: 12px; font-weight: 500;">
                        <i class="bi bi-x-circle me-2"></i>–û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="button" class="btn btn-warning flex-fill" onclick="updateSubscription('${email}', 'replace')" style="border-radius: 12px; padding: 12px; font-weight: 600; box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);">
                        <i class="bi bi-arrow-repeat me-2"></i>–ó–∞–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                    </button>
                    <button type="button" class="btn btn-success flex-fill" onclick="updateSubscription('${email}', 'merge')" style="border-radius: 12px; padding: 12px; font-weight: 600; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);">
                        <i class="bi bi-plus-circle me-2"></i>–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏
                    </button>
                </div>
            </div>
        </div>`;
    document.body.appendChild(modal);
    const bootstrapModal = new bootstrap.Modal(modal);
    bootstrapModal.show();
    modal.addEventListener('hidden.bs.modal', () => modal.remove());
}
function updateSubscription(email, action) {
    fetch('/subscribe/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: email, action: action })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            showToast('‚úÖ ' + data.message, 'success');
            const modal = bootstrap.Modal.getInstance(document.getElementById('subscription-choice-modal'));
            if (modal) modal.hide();
            const emailInput = document.getElementById('subscribe-email');
            if (emailInput) emailInput.value = '';
        } else {
            showToast('‚ùå ' + data.error, 'warning');
        }
    })
    .catch(() => showToast('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏', 'danger'));
}


// –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫ —Ñ–æ—Ä–º–µ –ø–æ–¥–ø–∏—Å–∫–∏
(function(){
  function scrollToAlerts(){
    var target = document.getElementById('job-alerts') || document.querySelector('.subscription-section');
    if (!target) return;
    var reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    target.scrollIntoView({ behavior: reduce ? 'auto' : 'smooth', block: 'start' });
  }
  var btn = document.getElementById('pager-subscribe-btn');
  if (btn){
    btn.addEventListener('click', scrollToAlerts);
    btn.addEventListener('keydown', function(e){
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); scrollToAlerts(); }
    });
  }
})();


/* –Ø–∑—ã–∫ (–∫–∞–∫ –±—ã–ª–æ) */
document.addEventListener("DOMContentLoaded", () => {
  const u = new URL(location.href);
  const lang = (u.searchParams.get("lang") || localStorage.getItem("gjh_lang") || "ru").toLowerCase();
  try { localStorage.setItem("gjh_lang", lang); } catch(_) {}
  if (window.gjhSetLang) window.gjhSetLang(lang);
});
</script>
{% endblock %}
